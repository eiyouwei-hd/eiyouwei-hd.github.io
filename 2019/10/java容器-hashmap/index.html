<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>HashMap之100问 | eiyouwei&#39;s home | Java Developer</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content=noodp><meta name=Description content=HashMap之100问><link rel=prev href=https://eiyouwei-hd.github.io/2019/10/j.u.c_aqs/><link rel=next href=https://eiyouwei-hd.github.io/2019/10/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/><link rel=canonical href=https://eiyouwei-hd.github.io/2019/10/java%E5%AE%B9%E5%99%A8-hashmap/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content=#da532c><meta name=theme-color content=#ffffff><meta name=twitter:card content=summary><meta name=twitter:title content=HashMap之100问><meta name=twitter:description content=HashMap之100问><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"HashMap之100问","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/eiyouwei-hd.github.io\/2019\/10\/java%E5%AE%B9%E5%99%A8-hashmap\/"},"image":{"@type":"ImageObject","url":"https:\/\/eiyouwei-hd.github.io\/cover.png","width":800,"height":600},"genre":"posts","keywords":"集合, HashMap","wordcount":2382,"url":"https:\/\/eiyouwei-hd.github.io\/2019\/10\/java%E5%AE%B9%E5%99%A8-hashmap\/","datePublished":"2019-10-22T00:00:00\x2b00:00","dateModified":"2019-10-22T00:00:00\x2b00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"XXXX","logo":{"@type":"ImageObject","url":"https:\/\/eiyouwei-hd.github.io\/logo.png","width":127,"height":40}},"description":"HashMap之100问"}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.10.1/css/all.min.css integrity="sha256-fdcFNFiBMrNfWL6OcAGQz6jDgNTRxnrLEd4vJYFWScE=" crossorigin=anonymous><link rel=stylesheet href=/css/lib/animate/animate.min.min.css></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=navbar-container><div class=navbar-header><a href=https://eiyouwei-hd.github.io/>eiyouwei&#39;s home | Java Developer</a></div><div class=navbar-menu><a class=menu-item href=https://eiyouwei-hd.github.io/posts/>Posts</a>
<a class=menu-item href=https://eiyouwei-hd.github.io/tags/>Tags</a>
<a class=menu-item href=https://eiyouwei-hd.github.io/categories/>Categories</a>
<a class=menu-item href=https://eiyouwei-hd.github.io/about/>About</a>
<a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a></div></div></nav><nav class=navbar-mobile><div class=navbar-container><div class=navbar-header><div><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw"></i></a><a href=https://eiyouwei-hd.github.io/>eiyouwei&#39;s home | Java Developer</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=https://eiyouwei-hd.github.io/posts/>Posts</a>
<a class=menu-item href=https://eiyouwei-hd.github.io/tags/>Tags</a>
<a class=menu-item href=https://eiyouwei-hd.github.io/categories/>Categories</a>
<a class=menu-item href=https://eiyouwei-hd.github.io/about/>About</a></div></div></nav><main class=main><div class=container><article class=post-warp><h1 class="post-title animated flipInX">HashMap之100问</h1><div class=post-meta><div class=post-meta-main><a class=author href=https://eiyouwei-hd.github.io/ rel=author><i class="fas fa-user-circle fa-fw"></i>eiyouwei&nbsp;</a>
<span class=post-category>收录于
<i class="far fa-folder fa-fw"></i><a href=https://eiyouwei-hd.github.io/categories/%E9%9B%86%E5%90%88/>集合</a></span></div><div class=post-meta-other><i class="far fa-calendar-alt fa-fw"></i><time datetime=2019-10-22>2019-10-22</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>约 2382 字&nbsp;
<i class="far fa-clock fa-fw"></i>预计阅读 5 分钟&nbsp;</div></div><div class=post-content><a class=post-dummy-target id=java容器-hashmap></a><h1>Java容器-HashMap</h1><a class=post-dummy-target id=hashmap原理></a><h2>HashMap原理</h2><ul><li>结构</li></ul><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://uploader.shimo.im/f/srFPXdsKK6Q8sJ7k.png!thumbnail alt=img class=lazyload><figcaption class=image-caption>img</figcaption></figure></p><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://uploader.shimo.im/f/LTOTYzRy3ek2bgor.png!thumbnail alt=img class=lazyload><figcaption class=image-caption>img</figcaption></figure></p><ul><li><p>相关参数</p><ul><li>默认初始化大小DEFAULT_INITIAL_CAPACITY = 16；</li></ul></li><li><p>默认加载因子DEFAULT_LOAD_FACTOR = 0.75f；</p><ul><li>数组+链表（1.8红黑树）</li></ul></li><li><p>扩容为2的n次幂</p><ul><li>hash = h^(h&gt;&gt;&gt;16)（1.8）</li><li>index = h &amp; (length-1)</li></ul></li></ul><a class=post-dummy-target id=put-get></a><h2>Put/Get</h2><ul><li>put：以下为个人总结，具体请参看源码<ul><li>定位桶：对key的hashCode()做hash运算，计算index</li><li>判断是否hash碰撞：</li><li>发生了hash碰撞时，判断节点是否是树节点，是就按红黑树的方式存放，否则就按列表的方式存放<ul><li>列表存放：比较该位置上存储的每一个key是否与新存入的相等，如果相等就替换之，（equals），否则就在该位置增加一个值，新加入的放在链头，最先加入的放在链尾（头插法1.7）</li><li>当链表大于预设的阈值8，就要转换成红黑树；</li></ul></li><li>如果bucket满了(超过load factor*current capacity)，就要resize</li></ul></li><li>get<ul><li>定位桶：对key的hashCode()做hash运算，计算index;</li><li>如果在bucket里的第一个节点里直接命中，则直接返回；</li><li>如果有冲突，则通过key.equals(k)去查找对应的Entry;</li><li>若为树，则在树中通过key.equals(k)查找，O(logn)；</li><li>若为链表，则在链表中通过key.equals(k)查找，O(n)。</li></ul></li></ul><a class=post-dummy-target id=多线程并发问题></a><h2>多线程并发问题</h2><ul><li>多线程扩容时，可能会阐释循环链表，在执行get的时候会触发死循环</li><li>多线程put的时候可能导致元素丢失</li><li>put非null元素后get出来的却是null</li><li>ref：<a href=https://juejin.im/post/5a66a08d5188253dc3321da0>https://juejin.im/post/5a66a08d5188253dc3321da0</a></li></ul><a class=post-dummy-target id=1-8做了哪些优化></a><h2>1.8做了哪些优化</h2><ul><li>结构改为：数组+链表+红黑树，优化查询性能<ul><li>在链表元素数量超过8时改为红黑树，少于6时改为链表，中间7不改是避免频繁转换降低性能；</li><li>相对于链表，改为红黑树后碰撞元素越多查询效率越高。链表O(n)，红黑树O(logn)</li></ul></li><li>优化高位运算的hash算法，降低hash冲突的几率：<ul><li>h^(h&gt;&gt;&gt;16)，将hashcode无符号右移16位，让高16位和低16位进行异或；</li></ul></li><li>扩容后，元素要么在原位置上，要么在原位置上移动2的n次幂的位置，且链表的顺序不变<ul><li>用的尾插法新的数组链表不会倒置，所以不会出现多线程下扩容的死循环问题</li></ul></li></ul><a class=post-dummy-target id=为什么用数组-链表></a><h2>为什么用数组+链表</h2><ul><li>数组是用来确定桶的位置，利用元素的key的hash值对数组长度取模得到.(定位)</li><li>链表是用来解决hash冲突问题，当出现hash值一样的情形，就在数组上的对应位置形成一条链表</li></ul><a class=post-dummy-target id=解决hash冲突的方法></a><h2>解决hash冲突的方法</h2><ul><li>开放定址法</li><li>链地址法(Java hashmap就是这么做的)</li><li>再hash法</li><li>公共溢出区域法</li><li>常见Hash算法：MurmurHash、MD4、MD5等等</li><li>参考链接:<ul><li><a href=https://blog.csdn.net/zeb_perfect/article/details/52574915>https://blog.csdn.net/zeb_perfect/article/details/52574915</a></li><li><a href=https://blog.csdn.net/woaitingting1985/article/details/84621589>https://blog.csdn.net/woaitingting1985/article/details/84621589</a></li></ul></li></ul><a class=post-dummy-target id=用linkedlist代替数组结构可以吗></a><h2>用LinkedList代替数组结构可以吗？</h2><ul><li>可以</li><li>为什么用数组不用LinkedList;<ul><li>查找效率高: 因为用数组效率是最高的,(hashMap可以直接定位到桶的位置,数组的查找效率比linkedList高)</li></ul></li><li>为什么用数组不用ArrayList<ul><li>扩容性能好: 采用基本数组结构，扩容机制可以自己定义，HashMap中数组扩容刚好是2的n次幂，在做取模运算的效率高。而ArrayList的扩容机制是1.5倍扩容</li></ul></li></ul><a class=post-dummy-target id=为什么扩容是2的n次幂></a><h2>为什么扩容是2的n次幂</h2><ul><li>因为下标是通过(n-1)&amp;hash计算出来的</li></ul><p><figure><img src=/images/loading.svg data-sizes=auto data-src=https://uploader.shimo.im/f/Nhf6T9YB7PsRwvEm.png!thumbnail alt=img class=lazyload><figcaption class=image-caption>img</figcaption></figure></p><a class=post-dummy-target id=为什么在解决hash冲突的时候-不直接用红黑树></a><h2>为什么在解决hash冲突的时候，不直接用红黑树?</h2><ul><li>红黑树需要进行左旋，右旋，这些操作来保持平衡：查询快，新增节点慢</li><li>元素较少时，单链表就能够保证查询性能</li></ul><a class=post-dummy-target id=用二叉查找树代替红黑树-可以么></a><h2>用二叉查找树代替红黑树，可以么</h2><ul><li>可以</li><li>但是二叉查找树在特殊情况下会变成一条线性结构（这就跟原来使用链表结构一样了，造成很深的问题），遍历查找会非常慢</li></ul><a class=post-dummy-target id=当链表转为红黑树后-什么时候退化为链表></a><h2>当链表转为红黑树后，什么时候退化为链表？</h2><ul><li>为6的时候退转为链表。中间有个差值7可以防止链表和树之间频繁的转换。</li></ul><a class=post-dummy-target id=为什么阀值是8呢></a><h2>为什么阀值是8呢？</h2><ul><li><p>时间和空间的权衡</p></li><li><p>ref：<a href=https://www.javazhiyin.com/34651.html>https://www.javazhiyin.com/34651.html</a></p></li></ul><a class=post-dummy-target id=一般用什么作为hashmap的key></a><h2>一般用什么作为HashMap的key？</h2><ul><li>一般用Integer、String这种<strong>不可变</strong>类当HashMap当key，而且String最为常用</li><li>因为字符串是不可变的，所以在它创建的时候hashcode就被缓存了，不需要重新计算，。这就使得字符串很适合作为Map中的键，字符串的处理速度要快过其它的键对象。这就是HashMap中的键往往都使用字符串。</li><li>因为获取对象的时候要用到equals()和hashCode()方法，那么键对象正确的重写这两个方法是非常重要的,这些类已经很规范的覆写了hashCode()以及equals()方法。</li></ul><a class=post-dummy-target id=用可变类当hashmap的key有什么问题></a><h2>用可变类当HashMap的key有什么问题</h2><ul><li>hashcode可能发生改变，导致put进去的值，无法get出</li></ul><a class=post-dummy-target id=如果让你实现一个自定义的class作为hashmap的key该如何实现></a><h2>如果让你实现一个自定义的class作为HashMap的key该如何实现</h2><ul><li>重写hashcode和equals方法注意什么<ul><li>两个对象想等，hashCode值一定相等</li><li>两个对象不等，hashCode值可能相等</li><li>hashcode相等，两个对象不一定相等</li><li>hashcode不等，两个对象一定不等</li></ul></li><li>如何设计一个不变类<ul><li>类添加final修饰符，保证类不被继承。</li><li>保证所有成员变量必须私有，并且加上final修饰</li><li>不提供改变成员变量的方法，包括setter</li><li>通过构造器初始化所有成员，进行深拷贝(deep copy)</li><li>在getter方法中，不要直接返回对象本身，而是克隆对象，并返回对象的拷贝</li></ul></li></ul><a class=post-dummy-target id=ref></a><h2>REF</h2><p>基本原理：<a href=https://juejin.im/post/5b551e8df265da0f84562403>https://juejin.im/post/5b551e8df265da0f84562403</a></p><p>相关问题：<a href=https://mp.weixin.qq.com/s/EZQHek-gl2SVnDRQs16nOw>https://mp.weixin.qq.com/s/EZQHek-gl2SVnDRQs16nOw</a></p><p>死循环：<a href=https://juejin.im/post/5a66a08d5188253dc3321da0>https://juejin.im/post/5a66a08d5188253dc3321da0</a></p></div><div class=post-footer id=post-footer><div class=post-info><div class=post-info-line><div class=post-info-mod><span>本文于 2019-10-22 更新</span></div><div class=post-info-license></div></div><div class=post-info-line><div class=post-info-md><span><a class=link-to-markdown href=https://eiyouwei-hd.github.io/2019/10/java%E5%AE%B9%E5%99%A8-hashmap/index.md target=_blank>阅读原始文档</a></span></div><div class=post-info-share><span></span></div></div></div><div class=post-info-more><section><span class=tag><a href=https://eiyouwei-hd.github.io/tags/%E9%9B%86%E5%90%88/><i class="fas fa-tag fa-fw"></i>集合</a></span>
<span class=tag><a href=https://eiyouwei-hd.github.io/tags/hashmap/><i class="fas fa-tag fa-fw"></i>HashMap</a></span></section><section><span><a href=javascript:window.history.back();>返回</a></span>&nbsp;|&nbsp;<span><a href=https://eiyouwei-hd.github.io/>主页</a></span></section></div><div class=post-nav><a href=https://eiyouwei-hd.github.io/2019/10/j.u.c_aqs/ class=prev rel=prev title=j.u.c_AQS><i class="fas fa-angle-left fa-fw"></i>j.u.c_AQS</a>
<a href=https://eiyouwei-hd.github.io/2019/10/%E9%9D%A2%E8%AF%95%E6%80%BB%E7%BB%93/ class=next rel=next title=面试总结>面试总结<i class="fas fa-angle-right fa-fw"></i></a></div></div><div class=post-comment><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script type=text/javascript>var gitalk=new Gitalk({id:"2019-10-22 00:00:00 \x2b0000 UTC",title:"HashMap之100问",clientID:"e38fc798c72a7e4e1386",clientSecret:"e151aa3b7b98d3cfaa1f096b88fdd7897e2c8007",repo:"xiaoheiAh.github.io",owner:"xiaoheiAh",admin:["xiaoheiAh"],body:decodeURI(location.href)});gitalk.render("gitalk-container");</script><noscript>Please enable JavaScript to view the <a href=https://github.com/gitalk/gitalk>comments powered by gitalk.</a></noscript></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line>由 <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a> 强力驱动&nbsp;|&nbsp;主题 - <a href=https://github.com/dillonzq/LoveIt target=_blank rel="external nofollow noopener noreffer">LoveIt<i class="far fa-heart fa-fw"></i></a></div><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2018 - 2019</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://eiyouwei-hd.github.io/>eiyouwei</a></span><span class=license>&nbsp;|&nbsp;<a rel="license external nofollow noopener noreffer" href=https://creativecommons.org/licenses/by-nc/4.0/ target=_blank>CC BY-NC 4.0</a></span></div></div></footer><script src=/js/lib/jquery/jquery.slim.min.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.min.js></script><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.min.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><script src=/js/blog.min.js></script></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span></a></body></html>